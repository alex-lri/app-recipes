<template>
  <div class="page" data-name="product">
    <div class="navbar">
      <div class="navbar-bg"></div>
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="#" class="link back">
            <i class="icon icon-back"></i>
            <span class="if-not-md">Back</span>
          </a>
        </div>
        <div class="title">${recipeDetails.strMeal}</div>
      </div>
    </div>
    <div class="page-content">
      <div class="block-title center-background-image recipe-title"
        style="background-image: url(${recipeDetails.strMealThumb});">
        <div class="mask-img">
          <h1>${recipeDetails.strMeal}</h1>
          <span>${recipeDetails.strCategory}</span>
        </div>
      </div>

      <div class="tags-container">
        ${recipeTags.map((tag) => $h`
        <span class="badge">${tag}</span>
        `)}
      </div>

      <div class="block block-strong ingredients-container">
        <h2>Ingrédients :</h2>
        <div class="list simple-list">
          <ul class="ingredients-list">
            ${ingredients.map((ingredient) => $h`
            <li class="ingredient-item" style="text-transform: capitalize; "><a href="">${ingredient.name}</a>
              <span>${ingredient.measure}</span>
            </li>
            `)}
          </ul>
        </div>

      </div>

      <div class="block block-strong instructions-container">
        <h2>Préparation :</h2>
        <p class="justify-content-center"
          style="font-size: 17px; text-align: justify; text-justify: inter-word; padding: 0px 10px 0px 10px;">
          ${recipeDetails.strInstructions}</p>
      </div>

      <div class="block block-strong">
        <p>
          <a href="#" class="button button-fill color-green" @click=${showToastIcon}>Add to wishlist !</a>
        </p>
      </div>
    </div>
  </div>
</template>
<script>
    export default (props, {
        $f7route,
        $store,
        $f7,
        $theme,
        $on,
    }) => {
        const recipeDetails = props.recipeDetails.meals[0];
        const favoriteRecipes = $store.getters.favoriteRecipes.value;
        const recipeTags = recipeDetails.strTags ? recipeDetails.strTags.split(',') : [];

        let localFavoritesRecipes = [];

        for (let r of favoriteRecipes) {
            localFavoritesRecipes.push(r);
        }

        let ingredients = getIngredients(recipeDetails);

        let toastIcon;
        const showToastIcon = () => {
            let recipe = {
                name: recipeDetails.strMeal,
                thumbUrl: recipeDetails.strMealThumb,
                idMeal: recipeDetails.idMeal,
            }

            let isAlreadyFavorite = false;

            for (let recipe of localFavoritesRecipes) {
                if (recipe.idMeal == recipeDetails.idMeal) {
                    isAlreadyFavorite = true;
                }
            }

            if (!isAlreadyFavorite) {
                localFavoritesRecipes.push(recipe)
                $store.dispatch('addFavoriteRecipe', recipe);

                // Create toast
                if (!toastIcon) {
                    toastIcon = $f7.toast.create({
                        icon: $theme.ios || $theme.aurora ? '<i class="f7-icons">heart_fill</i>' : '<i class="material-icons">heart_fill</i>',
                        text: 'Recipe add to favorites',
                        position: 'center',
                        closeTimeout: 2000,
                    });
                }
                // Open it
                toastIcon.open();
            }

        }

        $on('pageBeforeOut', () => {
            $f7.toast.close();
        })

        $on('pageBeforeRemove', () => {
            // Destroy toasts when page removed
            if (toastIcon) toastIcon.destroy();
        })
        return $render;
    };
</script>eturn $render; };
</script>