<template>
  <div class="page" data-name="catalog">
    <div class="navbar">
      <div class="navbar-bg"></div>
      <div class="navbar-inner sliding">
        <div class="title">Recettes</div>
      </div>
    </div>
    <div class="page-content">
      <div class="text-align-center">
        <h2>Liste des recettes disponibles</h2>
      </div>
      <div class="list">
        <ul class="categories-list">
          ${categories.value.map((category) => $h`
          <li class="center-background-image category-item mask-img" style="background-image: url(${category.strCategoryThumb});"><a href="/recipe-details/${category.idCategory}/">${category.strCategory}</a></li>
          `)}
        </ul>
      </div>
      ${categories.length === 3 && $h`
      <div class="block">
        <button class="button button-fill" @click=${addProduct}>Add Product</Button>
      </div>
      `}
      <div class="recipe-container" style="background-image: url(${randomRecipeThumbUrl});">
        <div class="mask-img">
          <h2>${randomRecipe.strMeal}</h2>
          <a class="recipe-btn" href="/recipe-details/${randomRecipe.idMeal}">Voir la recette</a>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
    export default (props, {
        $store,
        $onBeforeMount
    }) => {
        const randomRecipe = props.randomRecipe.meals[0];
        const randomRecipeThumbUrl = randomRecipe.strMealThumb;
        const categories = $store.getters.categories;

        $onBeforeMount(() => {

            const recipesCategoriesUrl = "https://www.themealdb.com/api/json/v1/1/categories.php";

            Framework7.request.get(recipesCategoriesUrl).then((res) => {
                var recipesCategories = JSON.parse(res.data);
                for (let category of recipesCategories.categories) {
                    $store.dispatch('addCategory', category);
                }
            });
        });

        return $render;
    }
</script>
